version: "3"

includes:
  ui:
    taskfile: ui/Taskfile.yml
    dir: ui
    internal: true

  cmd:
    taskfile: cmd/Taskfile.yml
    dir: cmd
    internal: true

tasks:
  install:
    desc: install npm packages
    deps:
      - ui:install
      - cmd:install

  test:
    desc: run tests
    deps:
      - ui:test

  run:
    desc: run the UI
    deps:
      - ui:run

  build:
    desc: transpile, bundle and create the release zip
    deps:
      - ui:build
      - cmd:build
    cmds:
      # Create a directory to hold all artifacts
      - mkdir -p analog
      # Move UI build artifacts
      - mv ui/dist ./analog/ui
      # Move CLI executables
      - mv cmd/analog-linux ./analog/
      - mv cmd/analog-windows.exe ./analog/
      - mv cmd/analog-macos ./analog/
      # Zip the combined artifacts
      - zip -r analog.zip analog/*
      # Cleanup the temporary directory
      - rm -rf analog
